<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <style>
        body {
            margin: 0;
            background: transparent;
            overflow: hidden;
            font-family: sans-serif;
        }

        .emote {
            height: 1.2em;
            width: auto;
            vertical-align: middle;
            margin: 0 0.15em;
        }

        .user {
            font-weight: bold;
            margin-right: 4px;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
            white-space: nowrap;
        }

        #notification-container {
            position: absolute;
            pointer-events: none;
            min-width: 250px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification {
            min-width: 200px;
            max-width: 600px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 16px 20px;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

            .notification.show {
                opacity: 1;
            }

            .notification.hide {
                opacity: 0;
            }

        .notification-title {
            display: block;
            font-size: 25px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            color: mediumpurple;
        }

        .notification-body {
            font-size: 16px;
            margin-bottom: 10px;
            text-align: center;
            color: white;
        }
    </style>
</head>
<body>
    <div id="notification-container"></div>

    <script>
        let ws;
        const socUrl = `ws://${window.location.host}/ws?type=notification`;
        const notificationContainer = document.getElementById("notification-container");
        const notificationQueue = [];
        let notificationActive = false;
        let nPosX = Math.random() * (window.innerWidth - 200);
        let nPosY = Math.random() * (window.innerHeight - 100);
        let nVelX = 3;
        let nVelY = 2;

        function connect() {
            ws = new WebSocket(socUrl);
            ws.onopen = e => {
                console.log(`Connected to ${window.location.host}!`);
            };
            ws.onclose = e => {
                console.log('Socket closed! Waiting to reconnect...', e.reason);
                setTimeout(function () {
                    connect();
                }, 2000);
            };

            ws.onmessage = e => {
                const msg = JSON.parse(e.data);
                notificationQueue.push(msg);
                processNotificationQueue();
            }
        }

        function processNotificationQueue() {
            if (notificationActive) return;
            if (notificationQueue.length === 0) return;

            notificationActive = true;
            const msg = notificationQueue.shift();
            showNotification(msg);
        }

        function showNotification(msg) {
            const el = document.createElement("div");
            el.className = "notification";

            const titleEl = document.createElement("div");
            titleEl.className = "notification-title";
            titleEl.innerHTML = msg.title;

            const bodyEl = document.createElement("div");
            bodyEl.className = "notification-body";
            bodyEl.innerHTML = msg.content;

            el.appendChild(titleEl);
            el.appendChild(bodyEl);

            notificationContainer.appendChild(el);

            requestAnimationFrame(() => el.classList.add("show"));

            setTimeout(() => {
                el.classList.remove("show");
                el.classList.add("hide");

                setTimeout(() => {
                    el.remove();
                    notificationActive = false;
                    processNotificationQueue();
                }, 400);
            }, msg.duration);
        }

        function updateBounce() {
            const el = document.getElementById("notification-container");
            if (!el) return;
            const rect = el.getBoundingClientRect();
            const rWidth = rect.width;
            const rHeight = rect.height;

            if (nPosX + rWidth >= window.innerWidth) {
                nVelX = -Math.abs(nVelX);
                nPosX = window.innerWidth - rWidth;
            }
            else if (nPosX <= 0) {
                nVelX = Math.abs(nVelX);
                nPosX = 0;
            }
            if (nPosY + rect.height >= window.innerHeight) {
                nVelY = -Math.abs(nVelY);
                nPosY = window.innerHeight - rHeight;
            }
            else if (nPosY <= 0) {
                nVelY = Math.abs(nVelY);
                nPosY = 0;
            }
            nPosX += nVelX;
            nPosY += nVelY;
            el.style.transform = `translate(${nPosX}px, ${nPosY}px)`;
            requestAnimationFrame(updateBounce);
        }

        connect();
        updateBounce();
    </script>
</body>
</html>